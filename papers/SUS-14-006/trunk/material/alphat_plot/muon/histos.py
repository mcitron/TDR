import ROOT as r
from array import *
from histo import *

################################################################################
# opts

rebin = True

################################################################################
# histos

data = Histo(name="data",title="data")
wjets = Histo(name="wjets",title="wjets",fill_colour=r.kBlue-1)
ttbar = Histo(name="ttbar",title="ttbar",fill_colour=r.kRed-1)
top = Histo(name="top",title="top",)
vv = Histo(name="vv",title="vv",)
dy = Histo(name="dy",title="dy",)

for his in [data,wjets,ttbar,top,vv,dy] :
    for bin in range(1,25) :
        his.h_.SetBinContent(bin,0.)
        his.h_.SetBinError(bin,0.)

################################################################################
# data

data.h_.SetBinContent(3,15.5)
data.h_.SetBinContent(4,350)
data.h_.SetBinContent(5,3025)
data.h_.SetBinContent(6,11405)
data.h_.SetBinContent(7,26449)
data.h_.SetBinContent(8,40423)
data.h_.SetBinContent(9,21969)
data.h_.SetBinContent(10,7253)
data.h_.SetBinContent(11,3732)
data.h_.SetBinContent(12,2276)
data.h_.SetBinContent(13,1611)
data.h_.SetBinContent(14,1187)
data.h_.SetBinContent(15,821)
data.h_.SetBinContent(16,628.5)
data.h_.SetBinContent(17,394)
data.h_.SetBinContent(18,210.8)
data.h_.SetBinContent(19,122.6)
data.h_.SetBinContent(20,86.4)
data.h_.SetBinContent(21,57.3)
data.h_.SetBinContent(22,36.7)
data.h_.SetBinContent(23,293.5)
data.h_.SetBinContent(24,3.84058)
data.h_.SetBinContent(25,1)
#
data.h_.SetBinError(3,2.783882)
data.h_.SetBinError(4,18.70829)
data.h_.SetBinError(5,55)
data.h_.SetBinError(6,106.7942)
data.h_.SetBinError(7,162.6315)
data.h_.SetBinError(8,201.0547)
data.h_.SetBinError(9,148.2194)
data.h_.SetBinError(10,85.16455)
data.h_.SetBinError(11,61.0901)
data.h_.SetBinError(12,47.70744)
data.h_.SetBinError(13,40.13726)
data.h_.SetBinError(14,34.45287)
data.h_.SetBinError(15,20.2608)
data.h_.SetBinError(16,17.7271)
data.h_.SetBinError(17,8.876936)
data.h_.SetBinError(18,6.493073)
data.h_.SetBinError(19,4.951767)
data.h_.SetBinError(20,4.156922)
data.h_.SetBinError(21,2.393742)
data.h_.SetBinError(22,1.915724)
data.h_.SetBinError(23,12.11404)
data.h_.SetBinError(24,0.1668241)
data.h_.SetBinError(25,1)

################################################################################
# wjets

wjets.h_.SetBinContent(3,15.44829)
wjets.h_.SetBinContent(4,378.8927)
wjets.h_.SetBinContent(5,2902.788)
wjets.h_.SetBinContent(6,9501.07)
wjets.h_.SetBinContent(7,20066.67)
wjets.h_.SetBinContent(8,29564.69)
wjets.h_.SetBinContent(9,14176.09)
wjets.h_.SetBinContent(10,4573.238)
wjets.h_.SetBinContent(11,2422.19)
wjets.h_.SetBinContent(12,1546.566)
wjets.h_.SetBinContent(13,1060.752)
wjets.h_.SetBinContent(14,799.4861)
wjets.h_.SetBinContent(15,573.6542)
wjets.h_.SetBinContent(16,419.8196)
wjets.h_.SetBinContent(17,279.2031)
wjets.h_.SetBinContent(18,165.1116)
wjets.h_.SetBinContent(19,102.6865)
wjets.h_.SetBinContent(20,68.67142)
wjets.h_.SetBinContent(21,46.90894)
wjets.h_.SetBinContent(22,28.8406)
wjets.h_.SetBinContent(23,249.1102)
wjets.h_.SetBinContent(24,3.295349)
wjets.h_.SetBinContent(25,2.360299)
#
wjets.h_.SetBinError(3,0.9056927)
wjets.h_.SetBinError(4,14.79526)
wjets.h_.SetBinError(5,21.50985)
wjets.h_.SetBinError(6,50.11503)
wjets.h_.SetBinError(7,77.52092)
wjets.h_.SetBinError(8,88.62513)
wjets.h_.SetBinError(9,54.97418)
wjets.h_.SetBinError(10,28.68219)
wjets.h_.SetBinError(11,22.95368)
wjets.h_.SetBinError(12,16.6568)
wjets.h_.SetBinError(13,13.81759)
wjets.h_.SetBinError(14,12.05697)
wjets.h_.SetBinError(15,7.20657)
wjets.h_.SetBinError(16,6.162582)
wjets.h_.SetBinError(17,3.211453)
wjets.h_.SetBinError(18,2.466212)
wjets.h_.SetBinError(19,1.943531)
wjets.h_.SetBinError(20,1.595166)
wjets.h_.SetBinError(21,0.9317594)
wjets.h_.SetBinError(22,0.7314367)
wjets.h_.SetBinError(23,11.16043)
wjets.h_.SetBinError(24,0.06681684)
wjets.h_.SetBinError(25,0.6491194)

################################################################################
# ttbar

ttbar.h_.SetBinContent(3,3.568245)
ttbar.h_.SetBinContent(4,53.65485)
ttbar.h_.SetBinContent(5,273.4986)
ttbar.h_.SetBinContent(6,2169.652)
ttbar.h_.SetBinContent(7,5944.551)
ttbar.h_.SetBinContent(8,11464.65)
ttbar.h_.SetBinContent(9,8759.682)
ttbar.h_.SetBinContent(10,2789.538)
ttbar.h_.SetBinContent(11,1402.512)
ttbar.h_.SetBinContent(12,809.2284)
ttbar.h_.SetBinContent(13,516.387)
ttbar.h_.SetBinContent(14,374.0831)
ttbar.h_.SetBinContent(15,266.8452)
ttbar.h_.SetBinContent(16,177.848)
ttbar.h_.SetBinContent(17,108.2227)
ttbar.h_.SetBinContent(18,49.75082)
ttbar.h_.SetBinContent(19,27.74049)
ttbar.h_.SetBinContent(20,15.91002)
ttbar.h_.SetBinContent(21,9.185214)
ttbar.h_.SetBinContent(22,5.105289)
ttbar.h_.SetBinContent(23,45.34893)
ttbar.h_.SetBinContent(24,0.5980707)
ttbar.h_.SetBinContent(25,0.2065544)
#
ttbar.h_.SetBinError(3,0.5991609)
ttbar.h_.SetBinError(4,3.296993)
ttbar.h_.SetBinError(5,7.354654)
ttbar.h_.SetBinError(6,20.77383)
ttbar.h_.SetBinError(7,34.32929)
ttbar.h_.SetBinError(8,47.76462)
ttbar.h_.SetBinError(9,41.75709)
ttbar.h_.SetBinError(10,23.56137)
ttbar.h_.SetBinError(11,16.67598)
ttbar.h_.SetBinError(12,12.70835)
ttbar.h_.SetBinError(13,10.14158)
ttbar.h_.SetBinError(14,8.629971)
ttbar.h_.SetBinError(15,5.154082)
ttbar.h_.SetBinError(16,4.194547)
ttbar.h_.SetBinError(17,2.072574)
ttbar.h_.SetBinError(18,1.400991)
ttbar.h_.SetBinError(19,1.053495)
ttbar.h_.SetBinError(20,0.7963403)
ttbar.h_.SetBinError(21,0.4242384)
ttbar.h_.SetBinError(22,0.3172104)
ttbar.h_.SetBinError(23,4.761771)
ttbar.h_.SetBinError(24,0.02930156)
ttbar.h_.SetBinError(25,0.2065544)

################################################################################
# single top

top.h_.SetBinContent(3,0.6164004)
top.h_.SetBinContent(4,13.23775)
top.h_.SetBinContent(5,135.2249)
top.h_.SetBinContent(6,440.5295)
top.h_.SetBinContent(7,1096.315)
top.h_.SetBinContent(8,1605.606)
top.h_.SetBinContent(9,819.4626)
top.h_.SetBinContent(10,278.5656)
top.h_.SetBinContent(11,146.2554)
top.h_.SetBinContent(12,112.2506)
top.h_.SetBinContent(13,89.82859)
top.h_.SetBinContent(14,60.24597)
top.h_.SetBinContent(15,44.4328)
top.h_.SetBinContent(16,33.52791)
top.h_.SetBinContent(17,16.83816)
top.h_.SetBinContent(18,9.49518)
top.h_.SetBinContent(19,5.952217)
top.h_.SetBinContent(20,2.960419)
top.h_.SetBinContent(21,1.937553)
top.h_.SetBinContent(22,1.193917)
top.h_.SetBinContent(23,8.738548)
top.h_.SetBinContent(24,0.1084207)
#
top.h_.SetBinError(3,0.3240257)
top.h_.SetBinError(4,2.33132)
top.h_.SetBinError(5,7.147717)
top.h_.SetBinError(6,13.06296)
top.h_.SetBinError(7,20.88758)
top.h_.SetBinError(8,25.52182)
top.h_.SetBinError(9,18.78323)
top.h_.SetBinError(10,11.29752)
top.h_.SetBinError(11,8.317503)
top.h_.SetBinError(12,7.309784)
top.h_.SetBinError(13,6.605378)
top.h_.SetBinError(14,5.427314)
top.h_.SetBinError(15,3.302165)
top.h_.SetBinError(16,2.863444)
top.h_.SetBinError(17,1.284663)
top.h_.SetBinError(18,0.9790048)
top.h_.SetBinError(19,0.7679726)
top.h_.SetBinError(20,0.5408736)
top.h_.SetBinError(21,0.305312)
top.h_.SetBinError(22,0.2420265)
top.h_.SetBinError(23,2.090281)
top.h_.SetBinError(24,0.01947048)

################################################################################
# dy

dy.h_.SetBinContent(3,0.1083508)
dy.h_.SetBinContent(4,6.838009)
dy.h_.SetBinContent(5,81.36621)
dy.h_.SetBinContent(6,335.1057)
dy.h_.SetBinContent(7,831.0515)
dy.h_.SetBinContent(8,1263.405)
dy.h_.SetBinContent(9,551.9007)
dy.h_.SetBinContent(10,146.7799)
dy.h_.SetBinContent(11,59.73182)
dy.h_.SetBinContent(12,38.06043)
dy.h_.SetBinContent(13,24.66819)
dy.h_.SetBinContent(14,21.49263)
dy.h_.SetBinContent(15,13.01347)
dy.h_.SetBinContent(16,9.94713)
dy.h_.SetBinContent(17,4.914844)
dy.h_.SetBinContent(18,3.266614)
dy.h_.SetBinContent(19,2.517153)
dy.h_.SetBinContent(20,0.9814729)
dy.h_.SetBinContent(21,0.9745265)
dy.h_.SetBinContent(22,0.4319124)
dy.h_.SetBinContent(23,6.019057)
dy.h_.SetBinContent(24,0.08191483)
dy.h_.SetBinContent(25,0.05423444)
#
dy.h_.SetBinError(3,0.03398012)
dy.h_.SetBinError(4,0.5305053)
dy.h_.SetBinError(5,2.140232)
dy.h_.SetBinError(6,7.876418)
dy.h_.SetBinError(7,15.20221)
dy.h_.SetBinError(8,17.60197)
dy.h_.SetBinError(9,9.143445)
dy.h_.SetBinError(10,5.655914)
dy.h_.SetBinError(11,1.861079)
dy.h_.SetBinError(12,2.716361)
dy.h_.SetBinError(13,3.023877)
dy.h_.SetBinError(14,3.754722)
dy.h_.SetBinError(15,1.45854)
dy.h_.SetBinError(16,2.009246)
dy.h_.SetBinError(17,0.2488632)
dy.h_.SetBinError(18,0.4848259)
dy.h_.SetBinError(19,0.6370661)
dy.h_.SetBinError(20,0.1073531)
dy.h_.SetBinError(21,0.1930642)
dy.h_.SetBinError(22,0.05058337)
dy.h_.SetBinError(23,1.734799)
dy.h_.SetBinError(24,0.0243787)
dy.h_.SetBinError(25,0.05423444)

################################################################################
# diboson

vv.h_.SetBinContent(3,0.2414657)
vv.h_.SetBinContent(4,4.158443)
vv.h_.SetBinContent(5,21.6278)
vv.h_.SetBinContent(6,71.0919)
vv.h_.SetBinContent(7,185.8206)
vv.h_.SetBinContent(8,282.1062)
vv.h_.SetBinContent(9,182.0122)
vv.h_.SetBinContent(10,76.04884)
vv.h_.SetBinContent(11,51.53353)
vv.h_.SetBinContent(12,32.00733)
vv.h_.SetBinContent(13,24.88695)
vv.h_.SetBinContent(14,19.45042)
vv.h_.SetBinContent(15,17.72627)
vv.h_.SetBinContent(16,19.23716)
vv.h_.SetBinContent(17,15.4383)
vv.h_.SetBinContent(18,9.554451)
vv.h_.SetBinContent(19,6.031349)
vv.h_.SetBinContent(20,3.611134)
vv.h_.SetBinContent(21,2.11436)
vv.h_.SetBinContent(22,1.368294)
vv.h_.SetBinContent(23,12.92615)
vv.h_.SetBinContent(24,0.1666244)
#
vv.h_.SetBinError(3,0.1235277)
vv.h_.SetBinError(4,0.7261546)
vv.h_.SetBinError(5,1.590611)
vv.h_.SetBinError(6,2.879789)
vv.h_.SetBinError(7,4.612524)
vv.h_.SetBinError(8,5.70523)
vv.h_.SetBinError(9,4.570049)
vv.h_.SetBinError(10,2.970573)
vv.h_.SetBinError(11,2.453521)
vv.h_.SetBinError(12,1.911375)
vv.h_.SetBinError(13,1.716914)
vv.h_.SetBinError(14,1.497709)
vv.h_.SetBinError(15,1.004595)
vv.h_.SetBinError(16,1.053693)
vv.h_.SetBinError(17,0.5992032)
vv.h_.SetBinError(18,0.4634665)
vv.h_.SetBinError(19,0.3722269)
vv.h_.SetBinError(20,0.2865288)
vv.h_.SetBinError(21,0.1554518)
vv.h_.SetBinError(22,0.12439)
vv.h_.SetBinError(23,2.542258)
vv.h_.SetBinError(24,0.01176006)

################################################################################
# sums

#residual = Histo(name="residual",fill_colour=r.kGreen+1)
residual = Histo(name="residual",fill_colour=r.kOrange-1)
residual.h_.Add(top.h_,1.)
residual.h_.Add(dy.h_,1.)
residual.h_.Add(vv.h_,1.)

residual1 = Histo(name="residual1",fill_colour=r.kOrange-2)
residual1.h_.Add(dy.h_,1.)
residual1.h_.Add(vv.h_,1.)

residual2 = Histo(name="residual2",fill_colour=r.kOrange-3)
residual2.h_.Add(vv.h_,1.)

partial = Histo(name="partial",fill_colour=r.kRed)
partial.h_.Add(residual.h_,1.) # previous
partial.h_.Add(ttbar.h_,1.)

total = Histo(name="total",fill_colour=r.kBlue)
total.h_.Add(partial.h_,1.) # previous
total.h_.Add(wjets.h_,1.) # previous

sm = Histo(name="sm")
sm.h_.Add(total.h_,1.) # previous

mcstat = Histo(name="mcstat",fill_colour=r.kBlack)
mcstat.h_.SetLineWidth(2)
mcstat.h_.SetFillStyle(3004)
mcstat.h_.Add(total.h_,1.) # previous
for bin in range( mcstat.h_.GetXaxis().GetNbins() ) :
    val = mcstat.h_.GetBinContent(bin+1)
    err = mcstat.h_.GetBinError(bin+1)
    print bin,val,err,err/val if val > 0. else 0. 
    mcstat.h_.SetBinContent(bin+1,1.)
    mcstat.h_.SetBinError(bin+1, err/val if val > 0. else 0. )
    
nd = data.h_.Integral(1,25)
nt = total.h_.Integral(1,25)
nr = data.h_.Integral(1,25)/total.h_.Integral(1,25)
print "nr:",nr

if rebin :
    data.rebin()

if rebin :
    for his in [total,partial,residual,residual1,residual2,wjets,ttbar,top,vv,dy,mcstat,sm] :
        his.rebin()

for his in [total,partial,residual,residual1,residual2,wjets,ttbar,top,vv,dy,sm] :
    his.h_.Scale(nr)

ratio = Histo(name="ratio")
if rebin : 
    ratio.rebin()
ratio.h_.Add(data.h_,1.)
ratio.h_.Divide(total.h_)
